<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Langton's Ant</title>
    <style type="text/css">
        h1 {
            text-align: center;
            font: bold italic 100px "Calibri";
            background-color: skyblue;
            margin-top: 0;
        }

        .box1 div {
            float: right;
            height: 250px;
            margin: 0 10px;
            border: yellowgreen solid 1px;
            padding: 10px;
            background-color: white;
        }

        h2 {
            text-align: center;
            font-size: 20px;
            margin: 10px 0px;
        }

        form {
            text-align: center;
            padding: 50px 0px;
            clear: both;
        }

        #board {
            margin: auto;
            border: 5px solid black;
        }

        td:hover {
            background: cadetblue !important;
        }
    </style>
</head>

<body style="background-color:#eee; margin:0;">

    <h1>Langton's Ant</h1>

    <div class="box1" style="width:926px; margin:auto;">
        <div style="width: 280px;">
            <h2>相关资料</h2>
            <ul style="padding-left:20px; margin: 0;">
                <li>
                    <a target="blank"
                        href="https://baike.baidu.com/item/%E5%85%B0%E9%A1%BF%E8%9A%82%E8%9A%81/10130501?fr=aladdin">兰顿蚂蚁--百度百科</a>
                </li>
                <li>
                    <a target="blank" href="http://en.wikipedia.org/wiki/Langton%27s_ant">Langton's Ant--Wikipedia</a>
                </li>
                <li>
                    <a target="blank"
                        href="https://www.bilibili.com/video/BV1h54y1d7C5">【Minecraft】10个有趣的兰顿蚂蚁玩法--bilibili</a>
                </li>
            </ul>
        </div>

        <div style="width: 320px;">
            <h2>关键问题</h2>
            <img src="highway.png" style="width:150px;float: right;">
            在蚂蚁行进到一定程度时，如右图所示，似乎总会出现以104步为周期无限重复的“高速公路”朝固定方向移动。然而到目前为止，对于一只蚂蚁的情况尚无法证明这是无论任何起始状态都会导致的必然结果。快来亲自试一试吧！<del>万一找到了反例呢</del>
        </div>

        <div style="width: 200px;">
            <h2>规则简介</h2>
            在平面上的正方形格被填上黑色或白色，其中一格上有一只“蚂蚁”，它的头部朝向上下左右其中一方。（1）若蚂蚁在黑格，右转90度，将该格改为白格，向前移一步；（2）若蚂蚁在白格，左转90度，将该格改为黑格，向前移一步。
        </div>
    </div>

    <form name="setup">
        <span>设置步数：</span><input type="text" value="Infinity" id="number" title="不输入默认为Infinity" onfocus="clearText(1);"
            onblur="writeText(1);">
        <input type="button" value="获取结果" onclick="antWalk(1);">
        <input type="button" value="清除" onclick="clearBoard();">
        <input type="button" value="生成动画" onclick="antWalk(2);">
        <input type="button" value="暂停" id="stop" onclick="pause();">
        <span>更新间隔：</span><input type="text" value="100" id="speed" title="毫秒数" onfocus="clearText(2);"
            onblur="writeText(2);">
        <span>当前步数：</span><span id="step">0</span>
    </form>

    <table id="board" cellspacing="0" cellpadding="0" title="点击更改颜色"></table><br>
    <hr><br>

    <script type="text/javascript">
        var row = 100, col = 100, cellWidth = 8, cellHeight = 8, array, project, times;
        drawBoard();


        function drawBoard() {
            var table = document.getElementById("board");
            for (var i = 0; i < row; i++) {
                var newRow = document.createElement("tr");
                table.appendChild(newRow);
                for (var j = 0; j < col; j++) {
                    var newCell = document.createElement("td");
                    newCell.setAttribute("id", "cell_" + i + "_" + j);
                    newCell.setAttribute("onclick", "changeColor(" + i + "," + j + ");");
                    newCell.style.width = cellWidth + "px";
                    newCell.style.height = cellHeight + "px";
                    newCell.style.border = "1px solid white";
                    newCell.style.background = "white";
                    newRow.appendChild(newCell);
                }
            }
        }

        function clearBoard() {
            erase();
            document.getElementById("step").innerHTML = 0;
            for (var i = 0; i < row; i++) {
                for (var j = 0; j < col; j++) {
                    setColor(i, j, "white");
                }
            }
        }

        function writeText(num) {
            if (num == 1 && document.getElementById("number").value == "") {
                document.getElementById("number").value = "Infinity";
            }
            if (num == 2 && document.getElementById("speed").value == "") {
                document.getElementById("speed").value = "100";
            }
        }

        function clearText(num) {
            (num == 1) ?
                document.getElementById("number").value = "" :
                document.getElementById("speed").value = "";
        }

        function getColor(i, j) {
            return document.getElementById("cell_" + i + "_" + j).style.backgroundColor;
        }

        function setColor(i, j, colorStr) {
            document.getElementById("cell_" + i + "_" + j).style.backgroundColor = colorStr;
        }

        function changeColor(i, j) {
            (getColor(i, j) == "black") ? setColor(i, j, "white") : setColor(i, j, "black");
        }

        function antWalk(num) {
            var numOfPace;
            (document.getElementById("number").value == "Infinity") ?
                numOfPace = Infinity :
                numOfPace = +document.getElementById("number").value;
            var pauseTime = +document.getElementById("speed").value;
            if (array == undefined) {
                times = 0;
                var direction = 0, currentX = Math.floor(row / 2), currentY = Math.floor(col / 2), currentColor = getColor(currentX, currentY);
            } else {
                var direction = array[0], currentX = array[1], currentY = array[2], currentColor = array[3];
            }

            if (num == 1) {
                clearInterval(project);
                while (++times <= numOfPace) {
                    if (currentX == row - 1 || currentY == col - 1 || currentX == 0 || currentY == 0) {
                        alert("蚂蚁撞到边界了！");
                        break;
                    }
                    array = onePace(direction, currentX, currentY, currentColor);
                    direction = array[0], currentX = array[1], currentY = array[2], currentColor = array[3];
                    document.getElementById("step").innerHTML = times;
                }
                erase();
            } else {
                if (project != undefined) {
                    alert("抱歉！目前还不支持生成多只蚂蚁同时运动的动画！");
                } else {
                    project = setInterval(function () {
                        if (currentX == row - 1 || currentY == col - 1 || currentX == 0 || currentY == 0) {
                            alert("蚂蚁撞到边界了！");
                            erase();
                        } else if (++times <= numOfPace) {
                            array = onePace(direction, currentX, currentY, currentColor);
                            direction = array[0], currentX = array[1], currentY = array[2], currentColor = array[3];
                            document.getElementById("step").innerHTML = times;
                        }
                    }, pauseTime);
                }
            }
        }

        function onePace(direction, currentX, currentY, currentColor) {
            if (currentColor == "white") {
                setColor(currentX, currentY, "black");
                direction = (direction + 1) % 4;
            } else {
                setColor(currentX, currentY, "white");
                direction = (direction + 3) % 4;
            }
            switch (direction) {
                case 0: currentX--; break;
                case 1: currentY++; break;
                case 2: currentX++; break;
                case 3: currentY--; break;
            }
            currentColor = getColor(currentX, currentY);
            setColor(currentX, currentY, "red");
            return [direction, currentX, currentY, currentColor];
        }

        function erase() {
            clearInterval(project);
            project = undefined;
            array = undefined;
            document.getElementById("stop").value = "暂停";
        }

        function pause() {
            if (project != undefined && document.getElementById("stop").value == "暂停") {
                clearInterval(project);
                document.getElementById("stop").value = "继续";
            } else if (project != undefined) {
                document.getElementById("stop").value = "暂停";
                project = undefined;
                antWalk(2);
            }
        }

    </script>
</body>

</html>